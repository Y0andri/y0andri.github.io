<!DOCTYPE html>
<html>
<head>
    <title>Chat con GitHub Gist</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
        #chat { border: 1px solid #ddd; padding: 10px; height: 400px; overflow-y: auto; }
        #input { width: 80%; padding: 8px; }
        button { padding: 8px 15px; background: #28a745; color: white; border: none; }
        .msg { margin: 5px 0; padding: 5px; background: #f8f9fa; }
    </style>
</head>
<body>
    <div id="chat"></div>
    <input type="text" id="input" placeholder="Escribe tu mensaje...">
    <button onclick="enviarMensaje()">Enviar</button>

    <script>
        // Configuración
        const GIST_ID = "e819bcd285a9d7cd439b0ffb01d1e8da"; // Reemplaza con tu ID
        const GH_TOKEN = "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"; // ¡NO lo publiques en GitHub Pages!
        const ARCHIVO = "blog.txt";

        // Obtener mensajes del Gist
        async function obtenerChat() {
            const url = `https://api.github.com/gists/${GIST_ID}`;
            const respuesta = await fetch(url, {
                headers: { "Authorization": `Bearer ${GH_TOKEN}` }
            });
            const gist = await respuesta.json();
            return gist.files[ARCHIVO].content;
        }

        // Actualizar el Gist con un nuevo mensaje
        async function actualizarChat(mensaje) {
            const contenido = await obtenerChat();
            const nuevoContenido = contenido + "\n" + mensaje;

            await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                method: "PATCH",
                headers: {
                    "Authorization": `Bearer ${GH_TOKEN}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    files: { [ARCHIVO]: { content: nuevoContenido } }
                })
            });
        }

        // Mostrar mensajes en el HTML
        async function mostrarChat() {
            const contenido = await obtenerChat();
            const lineas = contenido.split("\n");
            document.getElementById("chat").innerHTML = lineas
                .map(linea => `<div class="msg">${linea}</div>`)
                .join("");
        }

        // Enviar mensaje
        async function enviarMensaje() {
            const input = document.getElementById("input");
            const mensaje = `[${new Date().toLocaleTimeString()}] Usuario: ${input.value}`;
            
            await actualizarChat(mensaje);
            input.value = "";
            await mostrarChat();
        }

        // Actualizar cada 5 segundos
        setInterval(mostrarChat, 5000);
        mostrarChat(); // Cargar al inicio
    </script>
</body>
</html>